function [unmix1d] = ismrm_calculate_sense_unmixing_1d(acc_factor, csm1d)%% function [unmix1d] = ismrm_calculate_sense_unmixing_1d(acc_factor, csm, verbose)%% Calculates the unmixing coefficients for a single line of aliased images%% INPUT:%       acc_factor  scalar    : Acceleration factor, e.g. 2%       csm1d       [y, coil] : Coil sensitivity map for a single x%                               location%% OUTPUT:%       unmix1d     [y, coil] : Image unmixing coefficients for a single x location %%   Code made available for the ISMRM 2013 Sunrise Educational Course% %   Michael S. Hansen (michael.hansen@nih.gov)%   Philip Beatty (philip.beatty@sri.utoronto.ca)%[ny, nc] = size(csm1d);if mod(ny, acc_factor) ~= 0,    error('ny must be a multiple of acc_factor');endunmix1d = zeros(ny, nc);n_blocks = ny/acc_factor;for index = 1:n_blocks    A = csm1d(index:n_blocks:ny,:).';    if max(abs(A(:))) > 0,          unmix1d(index:n_blocks:ny, :) = pinv(A);    endend